{% extends "base.html" %}

{% block title %} Chatbot {% endblock %}

{% block content %}
  <!-- Main content for the chatbot page -->
  <div id="chatbox" style="position: fixed; bottom: 0; right: 0; width: 300px; max-width: 100%; height: 400px; background-color: #fff; border: 1px solid #ddd; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 5px; display: none; flex-direction: column;">
    <div id="chatOutput" style="flex: 1; overflow-y: auto; padding: 10px; border-bottom: 1px solid #ddd;"></div>
    <textarea id="chatInput" style="border: none; padding: 10px; width: 100%; height: 60px; resize: none;" placeholder="Type your message here..."></textarea>
  </div>
  <button id="chatToggle" style="position: fixed; bottom: 20px; right: 20px; background-color: #007bff; color: white; border: none; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 0 10px rgba(0,0,0,0.1);">Chat</button>
{% endblock %}

{% block extra_scripts %}
  <script>
    $(document).ready(function () {
      // Toggle chatbox visibility
      $('#chatToggle').on('click', function () {
        $('#chatbox').toggle();
      });

      // Send message to the server
      $('#chatInput').on('keypress', function (e) {
        if (e.which === 13 && !e.shiftKey) {
          e.preventDefault();
          const message = $(this).val();
          const context = ""; // Add context if needed

          fetch('/ask_tutor', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: message, context: context })
          })
          .then(response => response.json())
          .then(data => {
            $('#chatOutput').append(`<p>User: ${message}</p>`);
            $('#chatOutput').append(`<p>Tutor: ${data.reply}</p>`);
            $('#chatInput').val(''); // Clear input field
            $('#chatOutput').scrollTop($('#chatOutput')[0].scrollHeight); // Scroll to the bottom
          });
        }
      });
    });
  </script>
{% endblock %}
